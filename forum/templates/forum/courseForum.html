{% extends 'forum/forums.html' %}
{% block content %}
<h1>Forum</h1>

<!-- Dropdown for selecting a course -->
<div class="centered-dropdown">
    <div class="dropdown">
        <label for="courses" class="form-label">Select a Course:</label>
        <select id="courses" class="form-select">
            <option value="">-- Choose a Course --</option>
            {% for course in courses %}
            <option value="{{ course.id }}">{{ course.course_name }}</option>
            {% endfor %}
        </select>
    </div>
</div>

<!-- Container for posts -->
<div id="posts-container">
    <!-- Posts will be loaded here -->
</div>

<script>
    function loadCoursePosts(courseId) {
        // Clear existing posts
        document.getElementById("posts-container").innerHTML = '';

        // Make an AJAX request to the server
        fetch(`/forum/course/${courseId}/posts`)
            .then(response => response.json())
            .then(data => {
                // Populate the posts container with the received posts
                let postsHtml = '';
                data.posts.forEach(post => {
                    postsHtml += `<div class="post">
                        <h3><a href="{% url 'forum:postDetail' courseId post.id %}">${post.title}</a></h3>
                        <p>${post.content}</p>
                        <p>Posted by ${post.posted_by}</p>
                    </div>`;
                });
                document.getElementById("posts-container").innerHTML = postsHtml;
            })
            .catch(error => {
                console.error('Error fetching posts:', error);
            });
    }

    // Attach the loadCoursePosts function to the onchange event of the select element
    document.getElementById("courses").addEventListener('change', function() {
        const courseId = this.value;
        if (courseId) {
            loadCoursePosts(courseId);
        }
    });
</script>

{% endblock %}
